{% load markdown_extras %}

<div class="bg-gray-800 p-6 rounded-lg shadow">
  <div class="flex items-center justify-between mb-4">
    <div class="flex items-center gap-4">
      <h1 class="text-3xl font-bold text-white">{{ chapter.title }}</h1>
      {% if chapter.is_optional %}
      <span class="px-3 py-1 text-sm bg-blue-600 text-white rounded-full">Optional</span>
      {% endif %}
    </div>
    
    <div class="flex items-center gap-3">
      <button onclick="openNPCModal()" 
              class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
        <i class="fas fa-user-plus mr-2"></i>Add NPC
      </button>
      <a href="{% url 'campaigns:enemy_create' campaign_id=chapter.campaign.id %}" 
         class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors">
        <i class="fas fa-user-ninja mr-2"></i>Add Enemy
      </a>
      <button onclick="openLocationModal()" 
              class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors">
        <i class="fas fa-map-marker-alt mr-2"></i>Add Location
      </button>
      <a href="{% url 'campaigns:chapter_character_list' campaign_id=chapter.campaign.id chapter_id=chapter.id %}"
         class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors">
        <i class="fas fa-users mr-2"></i>Characters
      </a>
      <a href="{% url 'campaigns:chapter_edit' campaign_id=chapter.campaign.id chapter_id=chapter.id %}"
         class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors">
        Edit Chapter
      </a>
    </div>
  </div>
  
  <div class="flex gap-4 items-center mb-4">
    {% if chapter.level_range %}
    <span class="text-gray-400">Level Range: {{ chapter.level_range }}</span>
    {% endif %}
    <div class="flex items-center gap-2">
      <span class="text-gray-400">Status:</span>
      {% include "chapters/components/_status_badge.html" %}
    </div>
  </div>
  
  <hr class="border-gray-700 mb-4" />
  
  <!-- NPCs and Locations Side-by-Side -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- NPCs Section -->
    <div>
      {% include "chapters/components/_npcs_section.html" %}
    </div>
    
    <!-- Locations Section -->
    <div>
      {% include "chapters/components/_locations_section.html" %}
    </div>
  </div>

  <!-- Description Sections in 2-Column Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 text-gray-300">
    <div class="space-y-4">
      {% if chapter.summary %}
      <div>
        <h2 class="text-xl font-semibold text-white mb-2">Summary</h2>
        <div class="prose prose-invert prose-sm max-w-none">{{ chapter.summary|markdown }}</div>
      </div>
      {% endif %}
      
      {% if chapter.intro %}
      <div>
        <h2 class="text-xl font-semibold text-white mb-2">Introduction</h2>
        <div class="prose prose-invert prose-sm max-w-none">{{ chapter.intro|markdown }}</div>
      </div>
      {% endif %}
    </div>
    
    <div class="space-y-4">
      {% if chapter.dm_notes %}
      <div>
        <h2 class="text-xl font-semibold text-white mb-2">DM Notes</h2>
        <div class="prose prose-invert prose-sm max-w-none">{{ chapter.dm_notes|markdown }}</div>
      </div>
      {% endif %}
      
      {% if chapter.conclusion %}
      <div>
        <h2 class="text-xl font-semibold text-white mb-2">Conclusion</h2>
        <div class="prose prose-invert prose-sm max-w-none">{{ chapter.conclusion|markdown }}</div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
