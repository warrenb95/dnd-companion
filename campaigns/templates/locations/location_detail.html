{% extends "base.html" %}
{% load markdown_extras %}
{% block title %}{{ location.name }} - {{ campaign.title }}{% endblock %}

{% block content %}
<div class="my-4 sm:my-8 max-w-5xl mx-auto px-4">
  <div class="bg-gray-800 rounded-lg shadow-xl overflow-hidden">
    
    <!-- Header -->
    <div class="bg-gray-900 px-4 sm:px-6 py-4 border-b border-gray-700">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <h1 class="text-2xl sm:text-3xl font-bold text-white">{{ location.name }}</h1>
          {% if location.region %}
          <p class="text-gray-400 mt-1">{{ location.region }}</p>
          {% endif %}
          {% if location.tags %}
          <div class="flex flex-wrap gap-1 mt-2">
            {% for tag in location.tags|split:"," %}
              {% if tag.strip %}
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                {{ tag.strip }}
              </span>
              {% endif %}
            {% endfor %}
          </div>
          {% endif %}
        </div>
        
        <div class="flex flex-col sm:flex-row gap-2">
          <a href="{% url 'campaigns:location_edit' campaign_id=campaign.id location_id=location.id %}" 
             class="inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-md transition-colors">
            <i class="fas fa-edit mr-2"></i>Edit Location
          </a>
          <a href="{% url 'campaigns:location_delete' campaign_id=campaign.id location_id=location.id %}" 
             class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-md transition-colors">
            <i class="fas fa-trash mr-2"></i>Delete
          </a>
        </div>
      </div>
    </div>

    <div class="p-4 sm:p-6 space-y-6">
      
      <!-- Map Image -->
      {% if location.map_image %}
      <div class="bg-gray-750 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-white mb-3 flex items-center">
          <i class="fas fa-map mr-2 text-purple-400"></i>Location Map
        </h3>
        <div class="text-center">
          <img src="{{ location.map_image.url }}" alt="Map of {{ location.name }}" 
               class="max-w-full h-auto rounded-lg border border-gray-600 shadow-lg">
        </div>
      </div>
      {% endif %}
      
      <!-- Description -->
      {% if location.description %}
      <div class="bg-gray-750 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-white mb-3 flex items-center">
          <i class="fas fa-info-circle mr-2 text-blue-400"></i>Description
        </h3>
        <div class="text-gray-300 prose prose-sm max-w-none">
          {{ location.description|linebreaks }}
        </div>
      </div>
      {% endif %}

      <!-- Featured In Chapters -->
      {% if location.chapters.exists %}
      <div class="bg-gray-750 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-white mb-3 flex items-center">
          <i class="fas fa-book-open mr-2 text-green-400"></i>Featured in Chapters
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          {% for chapter in location.chapters.all %}
          <div class="bg-gray-700 rounded-lg p-3 hover:bg-gray-650 transition-colors">
            <h4 class="font-medium text-white">
              <a href="{% url 'campaigns:chapter_detail' campaign_id=campaign.id chapter_id=chapter.id %}" 
                 class="hover:text-indigo-400 transition-colors">
                {{ chapter.order }}. {{ chapter.title }}
              </a>
            </h4>
            {% if chapter.level_range %}
            <p class="text-sm text-gray-400">Level {{ chapter.level_range }}</p>
            {% endif %}
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium mt-2
              {% if chapter.status == 'completed' %}bg-green-100 text-green-800
              {% elif chapter.status == 'in_progress' %}bg-yellow-100 text-yellow-800
              {% else %}bg-gray-100 text-gray-800{% endif %}">
              {{ chapter.get_status_display }}
            </span>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Encounters -->
      {% with location.encounter_set.all as encounters %}
      {% if encounters %}
      <div class="bg-gray-750 rounded-lg p-4">
        <h3 class="text-lg font-semibold text-white mb-3 flex items-center">
          <i class="fas fa-sword mr-2 text-red-400"></i>Encounters at this Location
        </h3>
        <div class="space-y-3">
          {% for encounter in encounters %}
          <div class="bg-gray-700 rounded-lg p-3">
            <div class="flex items-center justify-between">
              <div>
                <h4 class="font-medium text-white">{{ encounter.title }}</h4>
                <p class="text-sm text-gray-400">{{ encounter.chapter.title }} - {{ encounter.get_type_display }}</p>
                {% if encounter.danger_level %}
                <span class="inline-block px-2 py-1 text-xs rounded mt-1
                  {% if encounter.danger_level == 'low' %}bg-green-600 text-white
                  {% elif encounter.danger_level == 'moderate' %}bg-yellow-600 text-white
                  {% elif encounter.danger_level == 'high' %}bg-orange-600 text-white
                  {% elif encounter.danger_level == 'deadly' %}bg-red-600 text-white
                  {% endif %}">
                  {{ encounter.get_danger_level_display }}
                </span>
                {% endif %}
              </div>
              <a href="{% url 'campaigns:chapter_detail' campaign_id=campaign.id chapter_id=encounter.chapter.id %}" 
                 class="text-indigo-400 hover:text-indigo-300 text-sm transition-colors">
                View Chapter
              </a>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
      {% endwith %}
      
    </div>
    
    <!-- Footer -->
    <div class="bg-gray-750 px-4 sm:px-6 py-4 border-t border-gray-700">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 text-sm text-gray-400">
        <p>Campaign: <span class="text-white">{{ campaign.title }}</span></p>
        <a href="{% url 'campaigns:campaign_detail' campaign_id=campaign.id %}" 
           class="inline-flex items-center text-indigo-400 hover:text-indigo-300 transition-colors">
          <i class="fas fa-arrow-left mr-2"></i>Back to Campaign
        </a>
      </div>
    </div>
    
  </div>
</div>
{% endblock %}